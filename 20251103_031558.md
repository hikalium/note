`````
hikalium@eevee:~/ollama-cli$ ollama run gemma3:27b
...

>>> Extensionsのアイコンをクリックしたら、今日の日付を`YYYYMMDD_hhmmss`の形式でキー入力したことにしてくれるC
... hromeエクステンションを作りたいです。どんなソースコードを書けばよいですか？
Chromeエクステンションで、アイコンクリック時に現在日時を`YYYYMMDD_hhmmss`形式でキー入力として処理するエ
クステンションのソースコード例を以下に示します。

**1. manifest.json**

```json
{
  "manifest_version": 3,
  "name": "Date Key Input",
  "version": "1.0",
  "description": "Clicks the extension icon to insert the current date and time as a key input.",
  "permissions": [
    "activeTab",
    "scripting"
  ],
  "action": {
    "default_popup": "popup.html"
  }
}
```

**2. popup.html**

```html
<!DOCTYPE html>
<html>
<head>
  <title>Date Key Input</title>
</head>
<body>
  <script src="popup.js"></script>
</body>
</html>
```

**3. popup.js**

```javascript
chrome.action.onClicked.addListener(function(tab) {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  const hour = String(now.getHours()).padStart(2, '0');
  const minute = String(now.getMinutes()).padStart(2, '0');
  const second = String(now.getSeconds()).padStart(2, '0');

  const formattedDate = `${year}${month}${day}_${hour}${minute}${second}`;

  chrome.scripting.executeScript({
    target: { tabId: tab.id },
    function: (formattedDate) => {
      // 現在フォーカスされている要素を取得
      const activeElement = document.activeElement;
      
      // フォーカスされている要素が入力フィールドかどうか確認
      if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 
'TEXTAREA')) {
        // 入力フィールドにフォーマットされた日付を挿入
        activeElement.value += formattedDate;

        // 入力フィールドにフォーカスを戻す (任意)
        activeElement.focus();
      } else {
        // 入力フィールド以外がアクティブだった場合は、コンソールにエラーを出力
        console.error("No active input field found.");
      }
    },
    args: [formattedDate]
  });
});
```

**解説:**

*   **manifest.json:**  エクステンションの名前、バージョン、説明、必要な権限（`activeTab`と`scripting`）
を定義します。  `action`セクションで、エクステンションのアイコンをクリックしたときに`popup.html`を表示す
るように指定します。
*   **popup.html:**  `popup.js`を読み込むだけのシンプルなHTMLファイルです。  アイコンをクリックすると、
このファイルが読み込まれます。
*   **popup.js:**
    *   `chrome.action.onClicked.addListener()`:  エクステンションのアイコンがクリックされたときに実行さ
れる関数を登録します。
    *   `new Date()`:  現在の日時を取得します。
    *   `getFullYear()`, `getMonth()`, `getDate()`, `getHours()`, `getMinutes()`, `getSeconds()`:  日付
と時刻の各要素を取得します。
    *   `padStart(2, '0')`:  日付と時刻の各要素が1桁の場合、先頭に`0`を付与して2桁にします。
    *   `chrome.scripting.executeScript()`:  現在アクティブなタブでJavaScriptコードを実行します。
        *   `target: { tabId: tab.id }`:  コードを実行するタブを指定します。
        *   `function: (formattedDate) => { ... }`:  タブで実行するJavaScriptコード。
            *   `document.activeElement`: 現在フォーカスされている要素を取得します。
            *   `activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA'`: フォーカス
されている要素が入力フィールドかテキストエリアか確認します。
            *   `activeElement.value += formattedDate`: 入力フィールドにフォーマットされた日付を追記しま
す。
            *   `activeElement.focus()`: 入力フィールドにフォーカスを戻します（オプション）。
        *   `args: [formattedDate]`: JavaScriptコードに渡す引数として、フォーマットされた日付を渡します
。

**インストール手順:**

1.  上記の3つのファイルを同じフォルダに保存します。
2.  Chromeの拡張機能ページ ( `chrome://extensions/` ) を開きます。
3.  「開発者モード」を有効にします。
4.  「展開済みの拡張機能を読み込む」ボタンをクリックします。
5.  保存したフォルダを選択します。

これで、エクステンションがインストールされ、アイコンをクリックすると、現在の日時がフォーマットされた文字
列として、フォーカスされている入力フィールドに追記されるようになります。

**注意点:**

*   このコードは、フォーカスされている入力フィールドに値を追記します。既存の値を上書きしたくない場合は、
追記する代わりに上書きしないようにコードを変更してください。
*   セキュリティ上の理由から、信頼できないウェブサイトでこのエクステンションを使用することは避けてくださ
い。

このコードが役に立つことを願っています！


>>> 動かなかったや…まあでもいいけど
動かなかったとのこと、申し訳ありません。原因が特定できず残念です。

うまくいかなかった場合、以下の点をチェックしてみてください。

*   **マニフェストファイル（manifest.json）の構文エラー:** JSONの構文は厳密なので、括弧やカンマの抜け漏れがないか確認
してください。JSON Lintなどのツールで検証できます。 ([https://jsonlint.com/](https://jsonlint.com/))
*   **権限:** manifest.jsonに、必要な権限（`activeTab`と`scripting`）が正しく記述されているか確認してください。
*   **開発者モード:** Chromeの拡張機能ページで「開発者モード」が有効になっていることを確認してください。
*   **エラーメッセージ:** 拡張機能のページで、エラーメッセージが表示されていないか確認してください。
*   **console.log:** popup.jsに`console.log`を追加して、コードが実行されているか、変数の値が正しいかを確認できます。


もし時間があれば、エラーメッセージや、popup.jsにconsole.logを追加した結果を教えていただければ、もう少し詳しく原因を特
定できるかもしれません。

まあ、いいとのことですので、もしよければ、他の質問やお手伝いできることがあれば、遠慮なくお申し付けください。
`````

- https://blog.nashcom.de/nashcomblog.nsf/dx/ollama-keep-models-loaded-for-longer-than-5-minutes-idle.htm?opendocument&comments
- https://github.com/hikalium/typedate

